# LinuxåŸºç¡€çŸ¥è¯†+InternStudioä»‹ç»

å®˜æ–¹è¯¦ç»†æ–‡æ¡£ï¼š[InternStudioä»‹ç»](https://aicarrier.feishu.cn/wiki/GQ1Qwxb3UiQuewk8BVLcuyiEnHe)

å®˜ç½‘åœ°å€ï¼š[ä¹¦ç”ŸÂ·æµ¦è¯­å®˜ç½‘](https://internlm.intern-ai.org.cn/)  

# 1.ç¬”è®°

**æµ¦è¯­æ¨¡å‹å¤§ä¸–çºªï¼šå‰ä¸ä¹…InternLM2.5é‡ç£…å‘å¸ƒï¼Œæ­å–œæ­å–œï¼ŒInternLM2.5 åœ¨ WAIC 24 ä¸Šå¼€æºå•¦ï½ï¼ŒInternLM2.5-7B-Chat ç™»é¡¶ Hugging Face OpenLLM Leaderboard  12B ä»¥ä¸‹æ¦œé¦–ï¼Œæ€§èƒ½æ¯”è‚© Llama 3 70Bï½**

https://zhuanlan.zhihu.com/p/707065312

> - **æ¨ç†èƒ½åŠ›å¤§å¹…æå‡**
> - **æœ‰æ•ˆæ”¯æŒç™¾ä¸‡å­—è¶…é•¿ä¸Šä¸‹æ–‡**
> - **å·¥å…·è°ƒç”¨èƒ½åŠ›æ•´ä½“å‡çº§**
>

https://github.com/internLM/InternLM

**ä¸€ã€æˆ‘ä»¬å…ˆç®€å•äº†è§£ä»€ä¹ˆæ˜¯SSHå’Œç«¯å£æ˜ å°„**

SSHå…¨ç§°Secure Shellï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºå®‰å…¨å¤–å£³ï¼Œå®ƒæ˜¯ä¸€ç§**ç½‘ç»œå®‰å…¨åè®®**ï¼Œé€šè¿‡åŠ å¯†å’Œè®¤è¯æœºåˆ¶å®ç°å®‰å…¨çš„è®¿é—®å’Œæ–‡ä»¶ä¼ è¾“ç­‰ä¸šåŠ¡ã€‚SSH åè®®é€šè¿‡å¯¹ç½‘ç»œæ•°æ®è¿›è¡ŒåŠ å¯†å’ŒéªŒè¯ï¼Œåœ¨ä¸å®‰å…¨çš„ç½‘ç»œç¯å¢ƒä¸­æä¾›äº†å®‰å…¨çš„ç½‘ç»œæœåŠ¡ã€‚

SSH æ˜¯ï¼ˆC/Sæ¶æ„ï¼‰ç”±**æœåŠ¡å™¨**å’Œ**å®¢æˆ·ç«¯**ç»„æˆï¼Œä¸ºå»ºç«‹å®‰å…¨çš„ SSH é€šé“ï¼ŒåŒæ–¹éœ€è¦å…ˆå»ºç«‹ TCP è¿æ¥ï¼Œç„¶ååå•†ä½¿ç”¨çš„ç‰ˆæœ¬å·å’Œå„ç±»ç®—æ³•ï¼Œå¹¶ç”Ÿæˆç›¸åŒçš„**ä¼šè¯å¯†é’¥**ç”¨äºåç»­çš„å¯¹ç§°åŠ å¯†ã€‚åœ¨å®Œæˆç”¨æˆ·è®¤è¯åï¼ŒåŒæ–¹å³å¯å»ºç«‹ä¼šè¯è¿›è¡Œæ•°æ®äº¤äº’ã€‚

åé¢å®è·µä¸­ä¼šé…ç½®SSHå¯†é’¥ï¼Œæ˜¯ä¸ºäº†ä¸è®©æˆ‘ä»¬è¿œç¨‹è¿æ¥å¼€å‘å¼€å‘æœºé‡å¤è¾“å…¥å¯†ç ã€‚

è¿œç¨‹è¿æ¥çš„å¥½å¤„å°±æ˜¯åŠå…¬çš„æ—¶å€™ï¼Œéœ€è¦æ‰§è¡Œä¸€äº›åŠå…¬ç”µè„‘ç¯å¢ƒçš„ä»£ç å°±å¾ˆæ–¹ä¾¿äº†ï¼Œä¸éœ€è¦æœ¬åœ°é…ç½®è¿™ä¹ˆéº»çƒ¦ã€‚

**äºŒã€æ€ä¹ˆä½¿ç”¨SSHè¿œç¨‹è¿æ¥å¼€å‘æœº**

æˆ‘ä»¬å…ˆè¿›è¡ŒSSHå¯†é’¥é…ç½®ï¼Œåœ¨æœ¬åœ°æ‰“å¼€powershellç»ˆç«¯ï¼Œä½¿ç”¨**win+R**æ‰“å¼€è¿è¡Œæ¡†è¾“å…¥`cmd`ï¼Œä½¿ç”¨**`ssh-keygen`**å‘½ä»¤æ¥ç”Ÿæˆå¯†é’¥ã€‚

![](./image/1.png)

**ssh-keygen**æ”¯æŒRSAå’ŒDSAä¸¤ç§è®¤è¯å¯†é’¥ã€‚

> å¸¸ç”¨å‚æ•°åŒ…æ‹¬ï¼š
>
> - -tï¼šæŒ‡å®šå¯†é’¥ç±»å‹ï¼Œå¦‚dsaã€ecdsaã€ed25519ã€rsaã€‚
> - -bï¼šæŒ‡å®šå¯†é’¥é•¿åº¦ã€‚
> - -Cï¼šæ·»åŠ æ³¨é‡Šã€‚
> - -fï¼šæŒ‡å®šä¿å­˜å¯†é’¥çš„æ–‡ä»¶åã€‚
> - -iï¼šè¯»å–æœªåŠ å¯†çš„ssh-v2å…¼å®¹çš„ç§é’¥/å…¬é’¥æ–‡ä»¶ã€‚

å‘½ä»¤å¦‚ä¸‹ï¼š

```python
ssh-keygen -t rsa
```

ç„¶åä¸€ç›´å›è½¦å³å¯ï¼Œå¯†é’¥é»˜è®¤æƒ…å†µä¸‹æ˜¯ç”Ÿæˆåœ¨`~/.ssh/`ç›®å½•ä¸‹çš„ï¼Œ`~`è¡¨ç¤ºçš„æ˜¯homeä¸»ç›®å½•ï¼Œå¦‚æœæ˜¯windowså°±æ˜¯`C:\Users\{your_username}\`ã€‚åœ¨powerShellä¸­å¯ä»¥ä½¿ç”¨`Get-Content`å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„å¯†é’¥ï¼Œå¦‚æœæ˜¯linuxæ“ä½œç³»ç»Ÿå¯ä»¥ä½¿ç”¨`cat`å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªid_rsa.pubæ–‡ä»¶ï¼Œæˆ‘ä»¬ç”¨è®°äº‹æœ¬æ‰“å¼€å¤åˆ¶å‡ºæ¥ï¼Œåœ¨Internstudioå¼€å‘æœºå¹³å°é¦–é¡µç‚¹å‡»é…ç½®**SSH Key**ï¼Œæ¥ç€ç‚¹å‡»**æ·»åŠ SSHå…¬é’¥**ï¼Œå°†åˆšåˆšç”Ÿæˆçš„å¯†é’¥å¤åˆ¶ä¸‹æ¥ï¼Œç²˜è´´åˆ°å…¬é’¥æ¡†ä¸­ï¼Œåç§°ä¼šè¢«è‡ªåŠ¨è¯†åˆ«åˆ°ï¼Œæœ€åç‚¹å‡»ç«‹å³æ·»åŠ ï¼ŒSSH Keyå°±é…ç½®å®Œæˆäº†ã€‚

![](./image/2.png)

å®Œæˆä¸Šè¿°é…ç½®åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨SSHè¿œç¨‹è¿æ¥è½¯ä»¶ï¼Œå¦‚ï¼š**Windtermã€Xterminalï¼ŒVscodeé‡Œé¢æ’ä»¶Remote -SSH**å®‰è£…æ’ä»¶åå¯ä»¥è¿æ¥åˆ°åˆ›å»ºçš„å¼€å‘æœºï¼Œç›´æ¥å°†å¼€å‘æœºçš„sshè¿æ¥å‘½ä»¤æ‰§è¡Œå³å¯ã€‚é…ç½®æ–‡ä»¶å°±é€‰é»˜è®¤çš„ã€‚

**ä¸‰ã€ç«¯å£æ˜ å°„**

**ç«¯å£æ˜ å°„**æ˜¯ä¸€ç§ç½‘ç»œæŠ€æœ¯ï¼Œå®ƒå¯ä»¥å°†å¤–ç½‘ä¸­çš„ä»»æ„ç«¯å£æ˜ å°„åˆ°å†…ç½‘ä¸­çš„ç›¸åº”ç«¯å£ï¼Œå®ç°å†…ç½‘ä¸å¤–ç½‘ä¹‹é—´çš„é€šä¿¡ã€‚é€šè¿‡ç«¯å£æ˜ å°„ï¼Œå¯ä»¥åœ¨å¤–ç½‘è®¿é—®å†…ç½‘ä¸­çš„æœåŠ¡æˆ–åº”ç”¨ï¼Œå®ç°è·¨è¶Šç½‘ç»œçš„ä¾¿æ·é€šä¿¡ã€‚

å› ä¸ºåœ¨åç»­çš„è¯¾ç¨‹ä¸­æˆ‘ä»¬ä¼šè¿›è¡Œæ¨¡å‹**web_demo**çš„éƒ¨ç½²å®è·µï¼Œé‚£åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½é‡åˆ°web uiåŠ è½½ä¸å…¨çš„é—®é¢˜ã€‚è¿™æ˜¯å› ä¸ºå¼€å‘æœºWeb IDEä¸­è¿è¡Œweb_demoæ—¶ï¼Œç›´æ¥è®¿é—®å¼€å‘æœºå†… http/https æœåŠ¡å¯èƒ½ä¼šé‡åˆ°ä»£ç†é—®é¢˜ï¼Œå¤–ç½‘é“¾æ¥çš„**uièµ„æº**æ²¡æœ‰è¢«åŠ è½½å®Œå…¨ã€‚

æ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¿è¡Œweb_demoçš„è¿æ¥è¿›è¡Œç«¯å£æ˜ å°„ï¼Œå°†**å¤–ç½‘é“¾æ¥æ˜ å°„åˆ°æˆ‘ä»¬æœ¬åœ°ä¸»æœº**ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ¬åœ°è¿æ¥è®¿é—®ï¼Œè§£å†³è¿™ä¸ªä»£ç†é—®é¢˜ã€‚ä¸‹é¢è®©æˆ‘ä»¬å®è·µä¸€ä¸‹ã€‚

æˆ‘ä»¬å¯ä»¥æ¥åˆ°å¼€å‘æœºè¿™è¾¹ï¼Œç‚¹å‡»è‡ªå®šä¹‰æœåŠ¡ï¼Œå¤åˆ¶ç¬¬ä¸€æ¡å‘½ä»¤ï¼Œ

```Bash
ssh -p 37367 root@ssh.intern-ai.org.cn -CNg -L {æœ¬åœ°æœºå™¨_PORT}:127.0.0.1:{å¼€å‘æœº_PORT} -o StrictHostKeyChecking=no
```

ä»‹ç»ä¸€ä¸‹å‘½ä»¤å„éƒ¨åˆ†çš„å«ä¹‰ï¼š

> - `-p 37367`ï¼šæ˜¯æŒ‡å®š SSH è¿æ¥çš„ç«¯å£ä¸º 37367ï¼Œè¿™ä¸ªå‰é¢æåˆ°è¿‡ã€‚
> - `root@ssh.intern-ai.org.cn`ï¼šè¡¨ç¤ºè¦ä»¥ `root` ç”¨æˆ·èº«ä»½è¿æ¥åˆ° `ssh.intern-ai.org.cn` è¿™ä¸ªä¸»æœºã€‚
> - `-CNg`ï¼š
>   - `-C` é€šå¸¸ç”¨äºå¯ç”¨å‹ç¼©ã€‚
>   - `-N` è¡¨ç¤ºä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œä»…å»ºç«‹è¿æ¥ç”¨äºç«¯å£è½¬å‘ç­‰ã€‚
>   - `-g` å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥åˆ°æœ¬åœ°è½¬å‘çš„ç«¯å£ã€‚
> - `-L {æœ¬åœ°æœºå™¨_PORT}:127.0.0.1:{å¼€å‘æœº_PORT}`ï¼šè¿™æ˜¯è®¾ç½®æœ¬åœ°ç«¯å£è½¬å‘ï¼Œå°†æœ¬åœ°æœºå™¨çš„æŒ‡å®šç«¯å£ï¼ˆç”± `{æœ¬åœ°æœºå™¨_PORT}` è¡¨ç¤ºï¼‰è½¬å‘åˆ°è¿œç¨‹ä¸»æœºï¼ˆè¿™é‡Œå³ `ssh.intern-ai.org.cn`ï¼‰çš„ `127.0.0.1` ï¼ˆå³æœ¬åœ°å›ç¯åœ°å€ï¼‰å’ŒæŒ‡å®šçš„å¼€å‘æœºç«¯å£ï¼ˆç”± `{å¼€å‘æœº_PORT}` è¡¨ç¤ºï¼‰ã€‚
> - `-o StrictHostKeyChecking=no`ï¼šå…³é—­ä¸¥æ ¼çš„ä¸»æœºå¯†é’¥æ£€æŸ¥ï¼Œè¿™æ ·å¯ä»¥é¿å…ç¬¬ä¸€æ¬¡è¿æ¥æ—¶å› ä¸ºæœªçŸ¥ä¸»æœºå¯†é’¥è€Œäº§ç”Ÿçš„æç¤ºæˆ–é”™è¯¯ã€‚

è¿™æ—¶å€™æˆ‘ä»¬åœ¨å¼€å‘æœºä¸­è¿è¡Œä¸€ä¸ªdemoçš„æ—¶å€™ï¼Œè¿›è¡Œç«¯å£æ˜ å°„ï¼Œåœ¨æœ¬åœ°æ‰“å¼€cmdï¼Œæ‰§è¡Œ

```Bash
ssh -p 37367 root@ssh.intern-ai.org.cn -CNg -L 6006:127.0.0.1:6006 -o StrictHostKeyChecking=no
```



æ³¨æ„æ¬¡å‘½ä»¤æ— ä»»ä½•è¿”å›ï¼Œå…¶å®VScodeæä¾›äº†è‡ªåŠ¨ç«¯å£æ˜ å°„åŠŸèƒ½ï¼Œä¸éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œä½¿ç”¨â€œCtrl+Shift+~â€å¿«æ·é”®**å”¤é†’ç»ˆç«¯**ï¼Œåœ¨ç»ˆç«¯çš„å³ä¾§å¯ä»¥æ‰¾åˆ°ç«¯å£é€‰é¡¹ï¼š

![](./image/output.png)

è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„web_demoçš„ä¾‹å­ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£sshï¼Œæˆ‘ä»¬æ— è®ºæ˜¯åœ¨å¼€å‘æœºé‡Œé¢è¿˜æ˜¯æœ¬åœ°VScodeé“¾æ¥äº†SSHä¹‹åæ–°å»ºä¸€ä¸ª`hello_world.py`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```python
import socket
import re
import gradio as gr
 
# è·å–ä¸»æœºå
def get_hostname():
    hostname = socket.gethostname()
    match = re.search(r'-(\d+)$', hostname)
    name = match.group(1)
    
    return name
 
# åˆ›å»º Gradio ç•Œé¢
with gr.Blocks(gr.themes.Soft()) as demo:
    html_code = f"""
            <p align="center">
            <a href="https://intern-ai.org.cn/home">
                <img src="https://intern-ai.org.cn/assets/headerLogo-4ea34f23.svg" alt="Logo" width="20%" style="border-radius: 5px;">
            </a>
            </p>
            <h1 style="text-align: center;">â˜ï¸ Welcome {get_hostname()} user, welcome to the ShuSheng LLM Practical Camp Course!</h1>
            <h2 style="text-align: center;">ğŸ˜€ Letâ€™s go on a journey through ShuSheng Island together.</h2>
            <p align="center">
                <a href="https://github.com/InternLM/Tutorial/blob/camp3">
                    <img src="https://oss.lingkongstudy.com.cn/blog/202406301604074.jpg" alt="Logo" width="20%" style="border-radius: 5px;">
                </a>
            </p>

            """
    gr.Markdown(html_code)

demo.launch()

```



ç ”ç©¶ä¸Šé¢çš„ä»£ç ï¼Œéœ€è¦å…ˆä½¿ç”¨`pip install gradio==4.29.0`å‘½ä»¤å®‰è£…ä»¥ä¸‹ä¾èµ–åŒ…ï¼Œç„¶ååœ¨Web IDEçš„ç»ˆç«¯ä¸­è¿è¡Œäº†ä¸€ä¸ª`hello_world.py`å³å¯ã€‚åªæœ‰è¿›è¡Œäº†ç«¯å£æ˜ å°„ï¼Œæˆ‘ä»¬æœ¬åœ°æ‰èƒ½è®¿é—®ï¼Œè¦ä¸ç„¶ä½ ç›´æ¥å»ä¹¦ç”Ÿæµ¦è¯­å¼€å‘æœºè®¾å¤‡é‚£ï¼Œè¿æ¥æ˜¾ç¤ºå™¨ï¼Œç”¨å¼€å‘æœºçš„æµè§ˆå™¨è®¿é—®ï¼Œå“ˆå“ˆå“ˆğŸ˜€ã€‚

ä¸‹é¢æ˜¯åœ¨è‡ªå·±è®¾å¤‡é‡Œé¢win+ræ‰“å¼€cmdï¼Œè¿è¡Œä¸‹é¢å‘½ä»¤ï¼Œ**è¯·æ³¨æ„ä¸‹é¢çš„46264ç«¯å£æ¢æˆè‡ªå·±sshé‡Œé¢çš„ç«¯å£å·ï¼Œåœ¨é‚£ä¸ª"å¼€å‘æœºâ€”SSHè¿æ¥"é‡Œé¢å¯ä»¥çœ‹åˆ°è‡ªå·±çš„ç«¯å£å·ï¼Œæ›¿æ¢ä¸‹å³å¯ğŸ˜€**ã€‚

```python
ssh -p 46264 root@ssh.intern-ai.org.cn -CNg -L 7860:127.0.0.1:7860 -o StrictHostKeyChecking=no
```



**è¿™é‡Œæˆ‘æ˜¯åˆ†å¼€æˆªå›¾çš„ï¼Œæ„æ€å°±æ˜¯æˆ‘å®‰è£…gradioäº¤äº’é¡µé¢çš„å‘½ä»¤æ˜¯åœ¨Internstudioå¼€å‘æœºé‡Œé¢æ‰§è¡Œï¼Œç„¶åè¿è¡Œweb_demoæ˜¯åœ¨æœ¬åœ°vscodeè¿æ¥sshä¹‹åå†ç»ˆç«¯æ‰§è¡Œçš„ï¼Œæœ¬åœ°æ‰“å¼€cmdæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œç„¶åå°±åœ¨æµè§ˆå™¨è¾“å…¥127.0.0.1:7860å³å¯ã€‚åé¢å†…å®¹æˆ‘å°±ç›´æ¥åœ¨å¼€å‘æœºä¸­æ“ä½œäº†ï¼Œè°¢è°¢å¤§å®¶~ğŸ˜€ğŸ˜€**

![](./image/6.png)

![](./image/5.png)

![](./image/4.png)

### 1.æ–‡ä»¶ç®¡ç†

åœ¨ Linux ä¸­ï¼Œå¸¸è§çš„æ–‡ä»¶ç®¡ç†æ“ä½œåŒ…æ‹¬ï¼š

- **åˆ›å»ºæ–‡ä»¶**ï¼šå¯ä»¥ä½¿ç”¨ `touch` å‘½ä»¤åˆ›å»ºç©ºæ–‡ä»¶ã€‚
- **åˆ›å»ºç›®å½•**ï¼šä½¿ç”¨ `mkdir` å‘½ä»¤ã€‚
- **ç›®å½•åˆ‡æ¢**ï¼šä½¿ç”¨`cd`å‘½ä»¤ã€‚
- **æ˜¾ç¤ºæ‰€åœ¨ç›®å½•**ï¼šä½¿ç”¨`pwd`å‘½ä»¤ã€‚
- **æŸ¥çœ‹æ–‡ä»¶å†…å®¹**ï¼šå¦‚ä½¿ç”¨ `cat` ç›´æ¥æ˜¾ç¤ºæ–‡ä»¶å…¨éƒ¨å†…å®¹ï¼Œ`more` å’Œ `less` å¯ä»¥åˆ†é¡µæŸ¥çœ‹ã€‚
- **ç¼–è¾‘æ–‡ä»¶**ï¼šå¦‚ `vi` æˆ– `vim` ç­‰ç¼–è¾‘å™¨ã€‚
- **å¤åˆ¶æ–‡ä»¶**ï¼šç”¨ `cp` å‘½ä»¤ã€‚
- **åˆ›å»ºæ–‡ä»¶é“¾æ¥**ï¼šç”¨`ln`å‘½ä»¤ã€‚
- **ç§»åŠ¨æ–‡ä»¶**ï¼šé€šè¿‡ `mv` å‘½ä»¤ã€‚
- **åˆ é™¤æ–‡ä»¶**ï¼šä½¿ç”¨ `rm` å‘½ä»¤ã€‚
- **åˆ é™¤ç›®å½•**ï¼š`rmdir`ï¼ˆåªèƒ½åˆ é™¤ç©ºç›®å½•ï¼‰æˆ– `rm -r`ï¼ˆå¯åˆ é™¤éç©ºç›®å½•ï¼‰ã€‚
- **æŸ¥æ‰¾æ–‡ä»¶**ï¼šå¯ä»¥ç”¨ `find` å‘½ä»¤ã€‚
- **æŸ¥çœ‹æ–‡ä»¶æˆ–ç›®å½•çš„è¯¦ç»†ä¿¡æ¯**ï¼šä½¿ç”¨`ls`å‘½ä»¤ï¼Œå¦‚ä½¿ç”¨ `ls -l`æŸ¥çœ‹ç›®å½•ä¸‹æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚
- > å¸¸ç”¨å‚æ•°åŠä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š
  >
  > - `-a`ï¼šæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼ˆä»¥`.`å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•ï¼‰ã€‚
  > - `-l`ï¼šä»¥é•¿æ ¼å¼æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶æƒé™ã€æ‰€æœ‰è€…ã€å¤§å°ã€ä¿®æ”¹æ—¶é—´ç­‰ã€‚
  > - `-h`ï¼šä¸`-l`ç»“åˆä½¿ç”¨ï¼Œä»¥äººç±»å¯è¯»çš„æ–¹å¼æ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼ˆå¦‚`K`ã€`M`ã€`G`ç­‰ï¼‰ã€‚
  > - `-R`ï¼šé€’å½’åˆ—å‡ºå­ç›®å½•çš„å†…å®¹ã€‚
  > - `-t`ï¼šæŒ‰æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ’åºæ˜¾ç¤ºã€‚
- **å¤„ç†æ–‡ä»¶**ï¼šè¿›è¡Œå¤æ‚çš„æ–‡ä»¶æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨`sed`å‘½ä»¤ã€‚
- > `sed`å‘½ä»¤æ˜¯ä¸€ç§æµç¼–è¾‘å™¨ï¼Œä¸»è¦ç”¨äºæ–‡æœ¬å¤„ç†ï¼Œåœ¨å¤„ç†å¤æ‚çš„æ–‡ä»¶æ“ä½œæ—¶ç»å¸¸ç”¨åˆ°ï¼Œåœ¨åç»­çš„è¯¾ç¨‹ä¸­ä¼šä½¿ç”¨åˆ°ï¼Œ`sed`å‘½ä»¤å¸¸ç”¨å‚æ•°åŠä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š
  >
  > - **å‚æ•°è¯´æ˜ï¼š**
  >   - `-e<script>` æˆ– `--expression=<script>`ï¼šç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šè„šæœ¬è¿›è¡Œæ–‡æœ¬å¤„ç†ã€‚
  >   - `-f<scriptæ–‡ä»¶>` æˆ– `--file=<scriptæ–‡ä»¶>`ï¼šä»æŒ‡å®šçš„è„šæœ¬æ–‡ä»¶ä¸­è¯»å–è„šæœ¬è¿›è¡Œæ–‡æœ¬å¤„ç†ã€‚
  >   - `-n` æˆ– `--quiet` æˆ– `--silent`ï¼šä»…æ‰“å°ç»è¿‡è„šæœ¬å¤„ç†åçš„è¾“å‡ºç»“æœï¼Œä¸æ‰“å°æœªåŒ¹é…çš„è¡Œã€‚
  > - **åŠ¨ä½œè¯´æ˜ï¼š**
  >   - `a`ï¼šåœ¨å½“å‰è¡Œçš„ä¸‹ä¸€è¡Œæ·»åŠ æŒ‡å®šçš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚
  >   - `c`ï¼šç”¨æŒ‡å®šçš„æ–‡æœ¬å­—ç¬¦ä¸²æ›¿æ¢æŒ‡å®šèŒƒå›´å†…çš„è¡Œã€‚
  >   - `d`ï¼šåˆ é™¤æŒ‡å®šçš„è¡Œã€‚
  >   - `i`ï¼šåœ¨å½“å‰è¡Œçš„ä¸Šä¸€è¡Œæ·»åŠ æŒ‡å®šçš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚
  >   - `p`ï¼šæ‰“å°ç»è¿‡é€‰æ‹©çš„è¡Œã€‚é€šå¸¸ä¸ `-n` å‚æ•°ä¸€èµ·ä½¿ç”¨ï¼Œåªæ‰“å°åŒ¹é…çš„è¡Œã€‚
  >   - `s`ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ–‡æœ¬æ›¿æ¢ã€‚ä¾‹å¦‚ï¼Œ`s/old/new/g` å°†æ‰€æœ‰ "InternLM" æ›¿æ¢ä¸º "InternLM yyds"ã€‚
- **æ–‡æœ¬æœç´¢å·¥å…·**ï¼šgrepï¼Œå¸¸ç”¨å‚æ•°å¦‚ä¸‹
> `-i`ï¼šå¿½ç•¥å¤§å°å†™è¿›è¡Œæœç´¢ã€‚
> `-v`ï¼šåè½¬åŒ¹é…ï¼Œå³æ˜¾ç¤ºä¸åŒ¹é…çš„è¡Œã€‚
> `-n`ï¼šæ˜¾ç¤ºè¡Œå·ã€‚
> `-c`ï¼šç»Ÿè®¡åŒ¹é…çš„è¡Œæ•°ã€‚

è¿™é‡Œå°±ç®€å•æ¼”ç¤ºå‡ ä¸ªå‘½ä»¤ï¼š

![](./image/7.png)

![](./image/9.png)

ç®—åŠ›IDæ‡’å¾—æ¨¡ç³Šäº†ï¼ŒåŸºç¡€ä¸å¤ªäº†è§£çš„åŒå­¦å»ºè®®å¤šç»ƒç»ƒæ‰‹è¿™äº›ç®€å•å‘½ä»¤ï¼Œå¯¹äº†è¿˜æœ‰ä¸ªvim or viå‘½ä»¤ï¼Œè¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥ç¼–è¾‘æ–‡ä»¶çš„ï¼Œæœ‰æ—¶å€™æ¯”å¦‚å¼€å‘æœºï¼Œå®éªŒæœºï¼Œæˆ–è€…åªæ”¯æŒviç¼–è¾‘å™¨çš„ï¼Œåˆšå¼€å§‹éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ã€‚ä¸‹é¢ç”¨å®˜æ–¹çš„å›¾æ¥è§£é‡Šä¸‰ç§æ¨¡å¼çš„å…³ç³»

![](./image/8.png)

è¿›å…¥ç¼–è¾‘æ¨¡å¼å¯ä»¥ä½¿ç”¨`i`ï¼Œvimçš„æ–¹ä¾¿ä¹‹å¤„å°±æ˜¯å¯ä»¥åœ¨ç»ˆç«¯è¿›è¡Œç®€å•çš„æ–‡ä»¶ä¿®æ”¹ã€‚

### 2. è¿›ç¨‹ç®¡ç†

**è¿›ç¨‹ç®¡ç†**å‘½ä»¤æ˜¯è¿›è¡Œç³»ç»Ÿç›‘æ§å’Œè¿›ç¨‹ç®¡ç†æ—¶çš„é‡è¦å·¥å…·ï¼Œå¸¸ç”¨çš„è¿›ç¨‹ç®¡ç†å‘½ä»¤æœ‰ä»¥ä¸‹å‡ ç§ï¼š

- **ps**ï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹
- **top**ï¼šåŠ¨æ€æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹
- **pstree**ï¼šæ ‘çŠ¶æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹
- **pgrep**ï¼šç”¨äºæŸ¥æ‰¾è¿›ç¨‹
- **nice**ï¼šæ›´æ”¹è¿›ç¨‹çš„ä¼˜å…ˆçº§
- **jobs**ï¼šæ˜¾ç¤ºè¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯
- **bg å’Œ fg**ï¼šå°†è¿›ç¨‹è°ƒå…¥åå°
- **kill**ï¼šæ€æ­»è¿›ç¨‹

åœ¨å¼€å‘æœºä¸­è¿˜æœ‰ä¸€æ¡ç‰¹æ®Šçš„å‘½ä»¤`nvidia-smi`ï¼Œå®ƒæ˜¯ NVIDIA ç³»ç»Ÿç®¡ç†æ¥å£ï¼ˆNVIDIA System Management Interfaceï¼‰çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç›‘æ§å’Œç®¡ç† NVIDIA GPU è®¾å¤‡ã€‚å®ƒæä¾›äº†ä¸€ç§å¿«é€ŸæŸ¥çœ‹ GPU çŠ¶æ€ã€ä½¿ç”¨æƒ…å†µã€æ¸©åº¦ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€ç”µæºä½¿ç”¨æƒ…å†µä»¥åŠè¿è¡Œåœ¨ GPU ä¸Šçš„è¿›ç¨‹ç­‰ä¿¡æ¯çš„æ–¹æ³•ã€‚

ä¸‹é¢æ˜¯å…³äºå„ä¸ªå‘½ä»¤ä½¿ç”¨ç¤ºä¾‹ï¼š

- `ps`ï¼šåˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­çš„è¿›ç¨‹ã€‚ä½¿ç”¨ä¸åŒçš„é€‰é¡¹å¯ä»¥æ˜¾ç¤ºä¸åŒçš„è¿›ç¨‹ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š

  - ```Bash
    ps aux  # æ˜¾ç¤ºç³»ç»Ÿæ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯
    ```

- `top`ï¼šåŠ¨æ€æ˜¾ç¤ºç³»ç»Ÿä¸­è¿›ç¨‹çš„çŠ¶æ€ã€‚å®ƒä¼šå®æ—¶æ›´æ–°è¿›ç¨‹åˆ—è¡¨ï¼Œæ˜¾ç¤ºCPUå’Œå†…å­˜ä½¿ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹ã€‚

  - ```Bash
    top  # å¯åŠ¨topå‘½ä»¤ï¼ŒåŠ¨æ€æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯
    ```

- `pstree`ï¼šä»¥æ ‘çŠ¶å›¾çš„å½¢å¼æ˜¾ç¤ºå½“å‰è¿è¡Œçš„è¿›ç¨‹åŠå…¶çˆ¶å­å…³ç³»ã€‚

  - ```Bash
    pstree  # æ˜¾ç¤ºè¿›ç¨‹æ ‘
    ```

- `pgrep`ï¼šæŸ¥æ‰¾åŒ¹é…æ¡ä»¶çš„è¿›ç¨‹ã€‚å¯ä»¥æ ¹æ®è¿›ç¨‹åã€ç”¨æˆ·ç­‰æ¡ä»¶æŸ¥æ‰¾è¿›ç¨‹ã€‚

  - ```Bash
    pgrep -u username  # æŸ¥æ‰¾ç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹
    ```

- `nice`ï¼šæ›´æ”¹è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚`nice` å€¼è¶Šä½ï¼Œè¿›ç¨‹ä¼˜å…ˆçº§è¶Šé«˜ã€‚

  - ```Bash
    nice -n 10 long-running-command  # ä»¥è¾ƒä½ä¼˜å…ˆçº§è¿è¡Œä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„å‘½ä»¤
    ```

- `jobs`ï¼šæ˜¾ç¤ºå½“å‰ç»ˆç«¯ä¼šè¯ä¸­çš„ä½œä¸šåˆ—è¡¨ï¼ŒåŒ…æ‹¬åå°è¿è¡Œçš„è¿›ç¨‹ã€‚

  - ```Bash
    jobs  # åˆ—å‡ºå½“å‰ä¼šè¯çš„åå°ä½œä¸š
    ```

- `bg` å’Œ `fg`ï¼š`bg` å°†æŒ‚èµ·çš„è¿›ç¨‹æ”¾åˆ°åå°è¿è¡Œï¼Œ`fg` å°†åå°è¿›ç¨‹è°ƒå›å‰å°è¿è¡Œã€‚

  - ```Bash
    bg  # å°†æœ€è¿‘ä¸€ä¸ªæŒ‚èµ·çš„ä½œä¸šæ”¾åˆ°åå°è¿è¡Œ
    fg  # å°†åå°ä½œä¸šè°ƒåˆ°å‰å°è¿è¡Œ
    ```

- `kill`ï¼šå‘é€ä¿¡å·åˆ°æŒ‡å®šçš„è¿›ç¨‹ï¼Œé€šå¸¸ç”¨äºæ€æ­»è¿›ç¨‹ã€‚

  - ```Bash
    kill PID  # æ€æ­»æŒ‡å®šçš„è¿›ç¨‹ID
    ```

  -  æ³¨æ„ï¼Œ`kill` å‘½ä»¤é»˜è®¤å‘é€ `SIGTERM` ä¿¡å·ï¼Œå¦‚æœè¿›ç¨‹æ²¡æœ‰å“åº”ï¼Œå¯ä»¥ä½¿ç”¨`-9`ä½¿ç”¨`SIGKILL` ä¿¡å·å¼ºåˆ¶æ€æ­»è¿›ç¨‹ï¼š

  - ```Bash
    kill -9 PID  # å¼ºåˆ¶æ€æ­»è¿›ç¨‹    
    ```

> `SIGTERM`ï¼ˆSignal Terminationï¼‰ä¿¡å·æ˜¯Unixå’Œç±»Unixæ“ä½œç³»ç»Ÿä¸­ç”¨äºè¯·æ±‚è¿›ç¨‹ç»ˆæ­¢çš„æ ‡å‡†ä¿¡å·ã€‚å½“ç³»ç»Ÿæˆ–ç”¨æˆ·æƒ³è¦ä¼˜é›…åœ°å…³é—­ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œé€šå¸¸ä¼šå‘é€è¿™ä¸ªä¿¡å·ã€‚ä¸`SIGKILL`ä¿¡å·ä¸åŒï¼Œ`SIGTERM`ä¿¡å·å¯ä»¥è¢«è¿›ç¨‹æ•è·å¹¶å¤„ç†ï¼Œä»è€Œå…è®¸è¿›ç¨‹åœ¨é€€å‡ºå‰è¿›è¡Œæ¸…ç†å·¥ä½œã€‚ï¼ˆæ¥æºäºç½‘ç»œï¼‰

ä»¥ä¸‹æ˜¯ `nvidia-smi` å‘½ä»¤çš„ä¸€äº›åŸºæœ¬å‘½ä»¤ç”¨æ³•ï¼š

- æ˜¾ç¤º GPU çŠ¶æ€çš„æ‘˜è¦ä¿¡æ¯ï¼š

  - ```Bash
    nvidia-smi
    ```

- æ˜¾ç¤ºè¯¦ç»†çš„ GPU çŠ¶æ€ä¿¡æ¯ï¼š

  - ```Bash
    nvidia-smi -l 1
    ```

  -  è¿™ä¸ªå‘½ä»¤ä¼šæ¯1ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€ä¿¡æ¯ã€‚

- æ˜¾ç¤º GPU çš„ä½¿ç”¨å†å²ï¼š

  - ```Bash
    nvidia-smi -h
    ```

- åˆ—å‡ºæ‰€æœ‰ GPU å¹¶æ˜¾ç¤ºå®ƒä»¬çš„ PID å’Œè¿›ç¨‹åç§°ï¼š

  - ```Bash
    nvidia-smi pmon
    ```

- å¼ºåˆ¶ç»“æŸæŒ‡å®šçš„ GPU è¿›ç¨‹ï¼š

  - ```Bash
    nvidia-smi --id=0 --ex_pid=12345
    ```

  -  è¿™ä¼šå¼ºåˆ¶ç»“æŸ GPU ID ä¸º 0 ä¸Šçš„ PID ä¸º 12345 çš„è¿›ç¨‹ã€‚

- è®¾ç½® GPU æ€§èƒ½æ¨¡å¼ï¼š

  - ```Bash
    nvidia-smi -pm 1
    nvidia-smi -i 0 -pm 1
    ```

  -  ç¬¬ä¸€ä¸ªå‘½ä»¤ä¼šä¸ºæ‰€æœ‰ GPU è®¾ç½®ä¸ºæ€§èƒ½æ¨¡å¼ï¼Œç¬¬äºŒä¸ªå‘½ä»¤åªé’ˆå¯¹ ID ä¸º 0 çš„ GPUã€‚

- é‡å¯ GPUï¼š

  - ```Bash
    nvidia-smi --id=0 -r
    ```

  -  è¿™ä¼šé‡å¯ ID ä¸º 0 çš„ GPUã€‚

- æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ï¼š

  - ```Bash
    nvidia-smi -h
    ```

ä¸‹é¢é€šè¿‡ä¸€å¼ å›¾ç‰‡å¯¹GPUä¿¡æ¯è¿›è¡Œä»‹ç»

![](./image/nvidia-smi.png)

### 3.**å·¥å…·ä½¿ç”¨**

è¿™é‡Œä»‹ç»ä¸€ä¸ªå·¥å…·`TMUX`ï¼Œ`TMUX` æ˜¯ä¸€ä¸ªç»ˆç«¯å¤šè·¯å¤ç”¨å™¨ã€‚å®ƒå¯ä»¥åœ¨å¤šä¸ªç»ˆç«¯ä¹‹é—´è½»æ¾åˆ‡æ¢ï¼Œåˆ†ç¦»å®ƒä»¬ï¼ˆè¿™ä¸ä¼šæ€æ­»ç»ˆç«¯ï¼Œå®ƒä»¬ç»§ç»­åœ¨åå°è¿è¡Œï¼‰å’Œå°†å®ƒä»¬é‡æ–°è¿æ¥åˆ°å…¶ä»–ç»ˆç«¯ä¸­ã€‚ä¸ºä»€ä¹ˆè¦ä»‹ç»è¿™ä¸ªå·¥å…·å‘¢ï¼Ÿå› ä¸ºåœ¨åé¢è¿›è¡Œ`Xtuner`å¾®è°ƒæ¨¡å‹çš„æ—¶å€™ï¼Œæ—¶é—´ä¼šå¾ˆé•¿ï¼Œä½¿ç”¨`Tmux`å¯ä»¥è§£å†³ç¨‹åºè¢«æ€æ­»ä¸­æ–­çš„æƒ…å†µï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹å¦‚ä½•å®‰è£…å¹¶ä½¿ç”¨ã€‚

å› ä¸ºå¼€å‘æœºä½¿ç”¨çš„æ˜¯ubuntuçš„æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨`lsb_release -a` å‘½ä»¤æŸ¥çœ‹ubuntuçš„ç³»ç»Ÿä¿¡æ¯ï¼š

![](./image/ubuntu.png)

ç„¶åä½¿ç”¨`apt install tmux`å‘½ä»¤å®‰è£…tmuxï¼Œå®‰è£…å®Œæˆä»¥åå¯ä»¥ä½¿ç”¨`tmux`å‘½ä»¤å°±å¯ä»¥ä½¿ç”¨tmuxäº†ï¼Œå¦‚æœæƒ³é€€å‡ºtmuxå¯ä»¥ä½¿ç”¨â€œ**Ctrl+d**â€å¿«æ·é”®ã€‚

> å› ä¸ºå¼€å‘æœºä¸æ”¯æŒæŒä¹…åŒ–çš„åº”ç”¨å®‰è£…ï¼Œæ‰€ä»¥æ¯æ¬¡é‡å¯å¼€å‘æœºéƒ½éœ€è¦é‡æ–°å®‰è£…ï¼Œå› ä¸ºå¼€å‘æœºæ˜¯ä¸€ä¸ªdockerå®¹å™¨ã€‚

è¿™é‡Œæ¨èæŸ¥çœ‹ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

[Tmuxä½¿ç”¨æ•™ç¨‹](https://www.ruanyifeng.com/blog/2019/10/tmux.html)

## å››ã€Condaå’ŒShellä»‹ç»

Conda æ˜¯ä¸€ä¸ªå¼€æºçš„åŒ…ç®¡ç†å’Œç¯å¢ƒç®¡ç†ç³»ç»Ÿï¼Œå¯åœ¨ Windowsã€macOS å’Œ Linux ä¸Šè¿è¡Œã€‚å®ƒå¿«é€Ÿå®‰è£…ã€è¿è¡Œå’Œæ›´æ–°è½¯ä»¶åŒ…åŠå…¶ä¾èµ–é¡¹ã€‚ä½¿ç”¨ Condaï¼Œæ‚¨å¯ä»¥è½»æ¾åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šåˆ›å»ºã€ä¿å­˜ã€åŠ è½½å’Œåˆ‡æ¢ä¸åŒçš„ç¯å¢ƒã€‚

åœ¨å¼€å‘æœºä¸­å·²ç»å®‰è£…äº†`conda`ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸”å¼€å‘æœºä¸­ä¹Ÿæœ‰å†…ç½®çš„`conda`å‘½ä»¤`studio-conda`ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šä»‹ç»`conda`çš„åŸºæœ¬ä½¿ç”¨ï¼Œè¿˜æœ‰`studio-conda`çš„ä½¿ç”¨æ–¹æ³•ä»¥åŠä»‹ç»ä¸€ä¸‹`studio-conda`æ˜¯æ€ä¹ˆå®ç°çš„ã€‚

æˆ‘ä»¬ä¼šä»ä¸‹é¢å‡ éƒ¨åˆ†è¿›è¡Œä»‹ç»ï¼š

> 1. condaè®¾ç½®
> 2. condaç¯å¢ƒç®¡ç†
> 3. condaå’Œpip
> 4. studio-condaä½¿ç”¨ä¸Shellï¼ˆæ‰©å±•ï¼‰

### 1.condaè®¾ç½®

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`conda --version`æ¥æŸ¥çœ‹å½“å‰å¼€å‘æœºä¸­`conda`çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥çœ‹condaçš„é…ç½®ä¿¡æ¯å¯ä»¥ä½¿ç”¨`conda config --show`å‘½ä»¤ï¼Œå¦‚æœæ˜¯å¼€å‘æœºé»˜è®¤çš„è®¾ç½®çš„è¯ä¼šè¿”å›ï¼šï¼ˆä¸€éƒ¨åˆ†ä¿¡æ¯ï¼‰ï¼š

![](./image/10.png)

 å½“æˆ‘ä»¬è¦ä½¿ç”¨`conda`å®‰è£…åŒ…çš„æ—¶å€™ä¼šéå¸¸æ…¢ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å›½å†…é•œåƒæå‡å®‰è£…é€Ÿåº¦ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```Bash
#è®¾ç½®æ¸…åé•œåƒ
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
```

ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨`pip`è¿›è¡ŒåŒ…çš„å®‰è£…çš„ï¼Œåé¢æˆ‘ä»¬ä¼šä»‹ç»`pip`å’Œ`conda`çš„åŒºåˆ«ã€‚

 è¿™äº›é…ç½®åœ¨`Conda`ç¯å¢ƒé…ç½®ä¸­ï¼Œä¼šå½±å“è½¯ä»¶åŒ…çš„å®‰è£…ã€æ›´æ–°ã€ç¯å¢ƒç®¡ç†ç­‰æ“ä½œçš„æ–¹å¼å’Œç»“æœã€‚ 

 ### 2. condaç¯å¢ƒç®¡ç†

è¿™ä¸€éƒ¨åˆ†æ˜¯`conda`ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼ŒæŒæ¡äº†è¿™ä¸€éƒ¨åˆ†å¤§å®¶å°±å¯ä»¥å°†å¼€å‘ç¯å¢ƒç©è½¬åˆ°é£èµ·äº†ğŸ˜€ã€‚

#### 2.1 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`conda create -n name python``=3.10`åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œè¿™é‡Œè¡¨ç¤ºåˆ›å»ºäº†pythonç‰ˆæœ¬ä¸º3.10ã€åå­—ä¸ºnameçš„è™šæ‹Ÿç¯å¢ƒã€‚åˆ›å»ºåï¼Œå¯ä»¥åœ¨`.conda`ç›®å½•ä¸‹çš„`envs`ç›®å½•ä¸‹æ‰¾åˆ°ã€‚

![img](https://aicarrier.feishu.cn/space/api/box/stream/download/asynccode/?code=YWQ5ZGEzOTg3MTg4MDUzY2VjMjE4MDZjMjZjZjU1OTJfUGNHNG12VlloR2xYSnRKcERuZjEwc3pucm1Mc0FDNEdfVG9rZW46SzZxWWJEVFdJb0x6VzV4ek5ENmNzbXkwbk9oXzE3MjA2ODcwNDc6MTcyMDY5MDY0N19WNA)

åœ¨ä¸æŒ‡å®špythonç‰ˆæœ¬æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºåŸºäºæœ€æ–°pythonç‰ˆæœ¬çš„è™šæ‹Ÿç¯å¢ƒã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„åŒæ—¶å®‰è£…å¿…è¦çš„åŒ…ï¼š`conda create -n name numpy matplotlib python=3.10`ï¼ˆä½†æ˜¯ä¸å»ºè®®å¤§å®¶è¿™æ ·ç”¨ï¼‰

åˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„å¸¸ç”¨å‚æ•°å¦‚ä¸‹ï¼š

- -n æˆ– --nameï¼šæŒ‡å®šè¦åˆ›å»ºçš„ç¯å¢ƒåç§°ã€‚
- -c æˆ– --channelï¼šæŒ‡å®šé¢å¤–çš„è½¯ä»¶åŒ…é€šé“ã€‚
- --cloneï¼šä»ç°æœ‰çš„ç¯å¢ƒå…‹éš†æ¥åˆ›å»ºæ–°ç¯å¢ƒã€‚
- -p æˆ– --prefixï¼šæŒ‡å®šç¯å¢ƒçš„å®‰è£…è·¯å¾„ï¼ˆéé»˜è®¤ä½ç½®ï¼‰ã€‚

#### 2.2 æŸ¥çœ‹æœ‰å“ªäº›è™šæ‹Ÿç¯å¢ƒ

å¦‚æœæƒ³è¦æŸ¥çœ‹æœ‰å“ªäº›è™šæ‹Ÿç¯å¢ƒæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š

```Bash
conda env list
conda info -e
conda info --envs
```

![](./image/11.png)

åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ç¯å¢ƒæ‰€åœ¨çš„ç›®å½•ã€‚

#### 2.3 æ¿€æ´»ä¸é€€å‡ºè™šæ‹Ÿç¯å¢ƒ

å½“æˆ‘ä»¬åˆ›å»ºå®Œè™šæ‹Ÿç¯å¢ƒåæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`conda activate name`å‘½ä»¤æ¥æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚ä½•æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦çœ‹`(base)`æ˜¯å¦å˜æˆäº†åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒçš„åç§°ã€‚

![img](https://aicarrier.feishu.cn/space/api/box/stream/download/asynccode/?code=MTg0Y2M0NmI1M2M2NDlkMmZiZTQ2ZDczM2U1NDVlZmFfRGRiajRaWFQ3eTFNMHpYcVRlOUFEQVF0bVlDenNNM1dfVG9rZW46UUlqM2JXYmM3b1dRZDV4UU9OZmNjWFU5bkplXzE3MjA2ODcwNDc6MTcyMDY5MDY0N19WNA)

 å¦‚æœæƒ³è¦é€€å‡ºè™šæ‹Ÿç¯å¢ƒçš„è¯å¯ä»¥ä½¿ç”¨ï¼š

```python
conda activate
conda deactivate
```

 è¿™ä¸¤æ¡å‘½ä»¤éƒ½ä¼šå›åˆ°`base`ç¯å¢ƒï¼Œå› ä¸º`base`æ˜¯condaçš„åŸºç¡€ç¯å¢ƒï¼Œå¦‚æœä»”ç»†è§‚å¯Ÿçš„è¯ï¼Œ`base`ç¯å¢ƒç›®å½•æ¯”å…¶ä»–çš„è™šæ‹Ÿç¯å¢ƒç›®å½•å±‚çº§è¦é«˜ã€‚

#### 2.4 åˆ é™¤ä¸å¯¼å‡ºè™šæ‹Ÿç¯å¢ƒ

å¦‚æœæƒ³è¦åˆ é™¤æŸä¸ªè™šæ‹Ÿç¯å¢ƒå¯ä»¥ä½¿ç”¨`conda remove --name name --all`ï¼Œå¦‚æœåªåˆ é™¤è™šæ‹Ÿç¯å¢ƒä¸­çš„æŸä¸ªæˆ–è€…æŸäº›åŒ…å¯ä»¥ä½¿ç”¨`conda remove --name name  package_name`

å¯¼å‡ºè™šæ‹Ÿç¯å¢ƒå¯¹äºç‰¹å®šçš„ç¯å¢ƒæ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œå› ä¸ºæœ‰äº›è½¯ä»¶åŒ…çš„ä¾èµ–å…³ç³»å¾ˆå¤æ‚ï¼Œå¦‚æœè‡ªå·±é‡æ–°è¿›è¡Œåˆ›å»ºå’Œé…ç½®çš„è¯å¾ˆéº»çƒ¦ï¼Œå¦‚æœæˆ‘ä»¬å°†é…ç½®å¥½çš„ç¯å¢ƒå¯¼å‡ºï¼Œè¿™æ ·ä¸‹æ¬¡ä½¿ç”¨è¿˜åŸå°±è¡Œäº†ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥æŠŠé…ç½®åˆ†äº«ç»™å…¶ä»–äººã€‚

```Bash
#è·å¾—ç¯å¢ƒä¸­çš„æ‰€æœ‰é…ç½®
conda env export --name myenv > myenv.yml
#é‡æ–°è¿˜åŸç¯å¢ƒ
conda env create -f  myenv.yml
```

æ¯”å¦‚æˆ‘ä»¬å°†`xtuner0.1.17`è™šæ‹Ÿç¯å¢ƒå¯¼å‡ºï¼Œé…ç½®ä¿¡æ¯æ˜¯è¿™æ ·çš„ï¼š

![](./image/12.png)

å…¶ä¸­åŒ…æ‹¬**ç¯å¢ƒåå­—**ã€**è™šæ‹Ÿç¯å¢ƒè½¯ä»¶åŒ…çš„åœ¨çº¿å­˜å‚¨åº“çš„ä½ç½®**å’Œ**è™šæ‹Ÿç¯å¢ƒçš„ä¾èµ–**ã€‚åé¢æˆ‘ä»¬ä¼šä½¿ç”¨è¿›é˜¶çš„ä½¿ç”¨æ–¹æ³•æ¥å¿«é€Ÿçš„è¿˜åŸè™šæ‹Ÿç¯å¢ƒã€‚

### 3. condaå’Œpip

è¿™éƒ¨åˆ†æˆ‘ä»¬ä»‹ç»ä¸€äº›`conda`å’Œ`pip`çš„ä¸€äº›åŒºåˆ«ï¼š

> 1. condaå¯ä»¥ç®¡ç†épythonåŒ…ï¼Œpipåªèƒ½ç®¡ç†pythonåŒ…ã€‚
> 2. condaå¯ä»¥ç”¨æ¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œpipä¸èƒ½ï¼Œéœ€è¦ä¾èµ–virtualenvä¹‹ç±»çš„åŒ…ã€‚
> 3. condaå®‰è£…çš„åŒ…æ˜¯ç¼–è¯‘å¥½çš„**äºŒè¿›åˆ¶æ–‡ä»¶**ï¼Œå®‰è£…åŒ…æ–‡ä»¶è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–åŒ…ï¼›pipå®‰è£…çš„åŒ…æ˜¯**wheelæˆ–æºç **ï¼Œè£…è¿‡ç¨‹ä¸­ä¸ä¼šå»æ”¯æŒpythonè¯­è¨€ä¹‹å¤–çš„ä¾èµ–é¡¹ã€‚
> 4. condaå®‰è£…çš„åŒ…ä¼šç»Ÿä¸€ä¸‹è½½åˆ°å½“å‰è™šæ‹Ÿç¯å¢ƒå¯¹åº”çš„ç›®å½•ä¸‹ï¼Œä¸‹è½½ä¸€æ¬¡å¤šæ¬¡å®‰è£…ã€‚pipæ˜¯ç›´æ¥ä¸‹è½½åˆ°å¯¹åº”ç¯å¢ƒä¸­ã€‚
>

> **Wheel** æ˜¯ä¸€ç§ Python å®‰è£…åŒ…çš„æ ¼å¼ã€‚
>
> å®ƒæ˜¯ä¸€ç§é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åˆ†å‘æ ¼å¼ï¼Œç±»ä¼¼äº conda ä¸­çš„å·²ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
>
> Wheel æ ¼å¼çš„ä¸»è¦ä¼˜ç‚¹åŒ…æ‹¬ï¼š
>
> 1. å®‰è£…é€Ÿåº¦å¿«ï¼šå› ä¸ºå·²ç»è¿›è¡Œäº†é¢„ç¼–è¯‘ï¼Œæ‰€ä»¥åœ¨å®‰è£…æ—¶ä¸éœ€è¦åƒæºç å®‰è£…é‚£æ ·è¿›è¡Œç¼–è¯‘è¿‡ç¨‹ï¼ŒèŠ‚çœäº†æ—¶é—´ã€‚
> 2. ä¸€è‡´æ€§ï¼šç¡®ä¿åœ¨ä¸åŒçš„ç³»ç»Ÿå’Œç¯å¢ƒä¸­å®‰è£…çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚
>
> ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¦å®‰è£…ä¸€ä¸ªå¤§å‹çš„ Python åº“ï¼Œä½¿ç”¨ Wheel æ ¼å¼å¯ä»¥é¿å…åœ¨ä¸åŒçš„æœºå™¨ä¸Šå› ä¸ºç¼–è¯‘ç¯å¢ƒçš„å·®å¼‚è€Œå¯¼è‡´çš„å®‰è£…é—®é¢˜ã€‚è€Œä¸”ï¼Œå¯¹äºé‚£äº›æ²¡æœ‰ç¼–è¯‘ç¯å¢ƒæˆ–è€…ç¼–è¯‘èƒ½åŠ›è¾ƒå¼±çš„ç³»ç»Ÿï¼ŒWheel æ ¼å¼èƒ½å¤Ÿè®©å®‰è£…è¿‡ç¨‹æ›´åŠ é¡ºç•…ã€‚

### 4. studio-condaä½¿ç”¨ä¸Shellï¼ˆæ‰©å±•ï¼Œä¸éœ€è¦åœ¨å¼€å‘æœºä¸­æ“ä½œï¼‰

è¿™ä¸€éƒ¨åˆ†å±äºæ‰©å±•çš„éƒ¨åˆ†ï¼Œå› ä¸ºæˆ‘è§‰å¾—è¿™ä¸€éƒ¨åˆ†éå¸¸æœ‰è¶£ï¼Œä¹Ÿéå¸¸å®ç”¨ï¼Œæ‰€ä»¥å¦‚æœå¤§å®¶æœ‰å…´è¶£çš„å¯ä»¥å­¦ä¹ ä¸€ä¸‹ã€‚

æˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹`studio-conda`ï¼Œè¿™æ˜¯å¼€å‘æœºå†…ç½®çš„ä¸€ä¸ªå‘½ä»¤ï¼Œå®ƒé€šè¿‡Shellè„šæœ¬æ¥å®ç°çš„ã€‚ä»€ä¹ˆæ˜¯Shellè„šæœ¬å‘¢ï¼Ÿ

> **Shell è„šæœ¬** æ˜¯ä¸€ç§åŒ…å«ä¸€ç³»åˆ—å‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ï¼Œè¿™äº›å‘½ä»¤æŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ’åˆ—ï¼Œç”¨äºåœ¨ Unix/Linux æˆ–ç±»ä¼¼çš„æ“ä½œç³»ç»Ÿç¯å¢ƒä¸­è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€‚
>
> Shell è„šæœ¬é€šå¸¸ä½¿ç”¨ Shell è¯­è¨€ç¼–å†™ï¼Œå¸¸è§çš„ Shell è¯­è¨€å¦‚ Bashã€Sh ç­‰ï¼Œå°±æ˜¯æˆ‘ä»¬å‰é¢æ‰€ä»‹ç»äº†LinuxåŸºç¡€å‘½ä»¤ï¼Œè¿™å°±å±äºShellè¯­è¨€ã€‚
>
> å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªé‡è¦ç‰¹ç‚¹ï¼š
>

> 1. **è‡ªåŠ¨åŒ–**ï¼šå¯ä»¥å°†ä¸€ç³»åˆ—é‡å¤ã€å¤æ‚çš„æ“ä½œç¼–å†™ä¸ºä¸€ä¸ªè„šæœ¬ï¼Œç„¶ååªéœ€è¿è¡Œè„šæœ¬å³å¯è‡ªåŠ¨å®Œæˆè¿™äº›æ“ä½œï¼Œä»è€ŒèŠ‚çœæ—¶é—´å’Œå‡å°‘é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œæ¯å¤©å®šæ—¶å¤‡ä»½é‡è¦æ–‡ä»¶çš„è„šæœ¬ã€‚
> 2. **ç³»ç»Ÿç®¡ç†**ï¼šç”¨äºç®¡ç†ç³»ç»Ÿé…ç½®ã€ç”¨æˆ·æƒé™ã€è¿›ç¨‹æ§åˆ¶ç­‰ã€‚æ¯”å¦‚ï¼Œåˆ›å»ºæ–°ç”¨æˆ·å¹¶è®¾ç½®å…¶æƒé™çš„è„šæœ¬ã€‚
> 3. **æ‰¹å¤„ç†**ï¼šèƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªæ–‡ä»¶æˆ–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€æ‰¹å›¾ç‰‡æ–‡ä»¶ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼çš„è„šæœ¬ã€‚
> 4. **æµç¨‹æ§åˆ¶**ï¼šåƒæ¡ä»¶åˆ¤æ–­ï¼ˆif-elseï¼‰ã€å¾ªç¯ï¼ˆforã€whileï¼‰ç­‰ï¼Œä½¿è„šæœ¬èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„æƒ…å†µæ‰§è¡Œä¸åŒçš„æ“ä½œã€‚
>

é‚£`studio-conda`å°±å±äºè‡ªåŠ¨åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨æˆ‘ä»¬å¼€å‘æœºä¸­rootç”¨æˆ·çš„bashç¯å¢ƒçš„é…ç½®æ–‡ä»¶æ˜¯`.bashrc`ï¼Œä½†å…¶å®ä¸»è¦çš„é…ç½®æ–‡ä»¶æ˜¯`/share/.aide/config/bashrc`ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™äº†ä¸€äº›å‘½ä»¤ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ›´å¿«æ·çš„æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ï¼š

```python
export no_proxy='localhost,127.0.0.1,0.0.0.0,172.18.47.140'
export PATH=/root/.local/bin:$PATH
export HF_ENDPOINT='https://hf-mirror.com'
alias studio-conda="/share/install_conda_env.sh"
alias studio-smi="/share/studio-smi"
```

`export`æ˜¯ç”¨æ¥è®¾ç½®ç¯å¢ƒå˜é‡çš„ï¼Œ`alias`æ˜¯å°†ä¸€ä¸ªshæ–‡ä»¶å¤åˆ¶ä¸ºä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå¯ä»¥ä½œä¸ºå‘½ä»¤åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œï¼Œæˆ‘ä»¬çš„`studio-conda`å°±æ˜¯è¿™æ ·çš„ã€‚

> è¿™é‡Œçš„studio-smiæ˜¯ç”¨æ¥æŸ¥çœ‹æŸ¥çœ‹è™šæ‹Ÿå†…å­˜å ç”¨çš„ï¼Œå½“æˆ‘ä»¬æ‰“å¼€`/share/studio-smi`æ–‡ä»¶å¯ä»¥çœ‹åˆ°ï¼š
>
> ```Bash
> #!/bin/bash
> 
> if command -v vgpu-smi &> /dev/null
> then
>     echo "Running studio-smi by vgpu-smi"
>     vgpu-smi
> else
>     echo "Running studio-smi by nvidia-smi"
>     nvidia-smi
> fi
> ```
>
> è¿™ä¸ªè„šæœ¬æ˜¯ç”¨äºæ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ `vgpu-smi` å‘½ä»¤ï¼Œå¦‚æœå­˜åœ¨ï¼Œå®ƒå°†è¿è¡Œ `vgpu-smi` æ¥æ˜¾ç¤ºè™šæ‹Ÿ GPU (vGPU) çš„çŠ¶æ€ä¿¡æ¯ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå®ƒå°†è¿è¡Œ `nvidia-smi` æ¥æ˜¾ç¤º NVIDIA GPU çš„çŠ¶æ€ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
>
> ![](./image/13.png)
>
> `nvidia-smi` æ˜¯ç”¨äºç›‘æ§å’Œç®¡ç†ç‰©ç† NVIDIA GPU è®¾å¤‡çš„å·¥å…·ï¼Œè€Œ `vgpu-smi` ä¸“é—¨ç”¨äºç›‘æ§å’Œç®¡ç†é€šè¿‡ NVIDIA vGPU æŠ€æœ¯è™šæ‹ŸåŒ–çš„ GPU èµ„æºã€‚

æˆ‘ä»¬æŸ¥çœ‹`/share/install_conda_env.sh`æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```Bash
#!/bin/bash
# clone internlm-base conda env to user's conda env
# created by xj on 01.07.2024
# modifed by xj on 01.19.2024 to fix bug of conda env clone
# modified by ljy on 01.26.2024 to extend

XTUNER_UPDATE_DATE=`cat /share/repos/UPDATE | grep xtuner |awk -F= '{print $2}'`
HOME_DIR=/root
CONDA_HOME=$HOME_DIR/.conda
SHARE_CONDA_HOME=/share/conda_envs
SHARE_HOME=/share

list() {
    cat <<-EOF
  é¢„è®¾ç¯å¢ƒ          æè¿°

  internlm-base    pytorch:2.0.1, pytorch-cuda:11.7
  xtuner           Xtuner(æºç å®‰è£…: main $(echo -e "\033[4mhttps://github.com/InternLM/xtuner/tree/main\033[0m"), æ›´æ–°æ—¥æœŸï¼š$XTUNER_UPDATE_DATE)
  pytorch-2.1.2    pytorch:2.1.2, pytorch-cuda:11.8
EOF
}

help() {
    cat <<-EOF
  è¯´æ˜: ç”¨äºå¿«é€Ÿcloneé¢„è®¾çš„condaç¯å¢ƒ

  ä½¿ç”¨: 
  
    1. studio-conda env -l/list æ‰“å°é¢„è®¾çš„condaç¯å¢ƒåˆ—è¡¨
  
    2. studio-conda <target-conda-name> å¿«é€Ÿclone: é»˜è®¤æ‹·è´internlm-base condaç¯å¢ƒ
    
    3. studio-conda -t <target-conda-name> -o <origin-conda-name> å°†é¢„è®¾çš„condaç¯å¢ƒæ‹·è´åˆ°æŒ‡å®šçš„condaç¯å¢ƒ
        
EOF
}

clone() {
    source=$1
    target=$2

    if [[ -z "$source" || -z "$target" ]]; then
        echo -e "\033[31m è¾“å…¥ä¸ç¬¦åˆè§„èŒƒ \033[0m"
        help
        exit 1
    fi

    if [ ! -d "${SHARE_CONDA_HOME}/$source" ]; then
        echo -e "\033[34m æŒ‡å®šçš„é¢„è®¾ç¯å¢ƒ: $sourceä¸å­˜åœ¨\033[0m"
        list
        exit 1
    fi

    if [ -d "${CONDA_HOME}/envs/$target" ]; then
        echo -e "\033[34m æŒ‡å®šcondaç¯å¢ƒçš„ç›®å½•: ${CONDA_HOME}/envs/$targetå·²å­˜åœ¨, å°†æ¸…ç©ºåŸç›®å½•å®‰è£… \033[0m"
        wait_echo&
        wait_pid=$!
        rm -rf "${CONDA_HOME}/envs/$target"
        kill $wait_pid
    fi

    echo -e "\033[34m [1/2] å¼€å§‹å®‰è£…condaç¯å¢ƒ: <$target>. \033[0m"
    sleep 3
    tar --skip-old-files -xzvf /share/pkgs.tar.gz -C ${CONDA_HOME}
    wait_echo&
    wait_pid=$!
    conda create -n $target --clone ${SHARE_CONDA_HOME}/${source}
    if [ $? -ne 0 ]; then
        echo -e "\033[31m åˆå§‹åŒ–condaç¯å¢ƒ: ${target}å¤±è´¥ \033[0m"
        exit 10
    fi

    kill $wait_pid

    # for xtuner, re-install dependencies
    case "$source" in
    xtuner)
        source_install_xtuner $target
        ;;
    esac

    echo -e "\033[34m [2/2] åŒæ­¥å½“å‰condaç¯å¢ƒè‡³jupyterlab kernel \033[0m"
    lab add $target
    source $CONDA_HOME/bin/activate $target
    cd $HOME_DIR

    echo -e "\033[32m condaç¯å¢ƒ: $targetå®‰è£…æˆåŠŸ! \033[0m"

    echo """
    ============================================
                    ALL DONE!
    ============================================
    """
}

Â·Â·Â·Â·Â·Â·
dispatch $@
```

å…¶ä¸­çš„*`list`*`()`ç­‰ï¼Œéƒ½æ˜¯`studio-conda`çš„å‡½æ•°ï¼Œå¯ä»¥å®ç°æŸäº›æ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`studio-conda env list`æ¥æŸ¥çœ‹é¢„è®¾çš„ç¯å¢ƒï¼š

![](./image/14.png)U0tpV2JvaGF1bzA0cEx4UmxOVGNkYzJwbkJlXzE3MjA2ODgzODQ6MTcyMDY5MTk4NF9WNA)

å…¶ä¸­*`clone`*`()`å‡½æ•°çš„ä¸»è¦ä½œç”¨å°±æ˜¯ç”¨æ¥å¤åˆ¶ç¯å¢ƒçš„ï¼Œä¸è¿‡åªèƒ½ä»é¢„è®¾çš„ç¯å¢ƒä¸­è¿›è¡Œå¤åˆ¶ï¼Œä¸»è¦çš„ä»£ç å…¶å®å°±æ˜¯ï¼š

```Bash
tar --skip-old-files -xzvf /share/pkgs.tar.gz -C ${CONDA_HOME}

conda create -n $target --clone ${SHARE_CONDA_HOME}/${source}
```

è§£å‹é¢„è®¾ç¯å¢ƒçš„å‹ç¼©åŒ…ï¼Œç„¶åé€šè¿‡cloneåˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œä¸è¿‡åœ¨Shellè„šæœ¬ä¸­è¿˜è®¾ç½®äº†ä¸€äº›é€»è¾‘ï¼Œä¸è¿‡éƒ½æ˜¯ä¸€äº›åˆ¤æ–­ï¼Œå¦‚æœä½ ç†Ÿæ‚‰ä»»ä½•ä¸€ç§ç¼–ç¨‹è¯­è¨€åº”è¯¥éƒ½å¯ä»¥çœ‹æ‡‚ï¼Œå¦‚æœçœ‹ä¸æ‡‚é—®é¢˜ä¹Ÿä¸å¤§ã€‚

é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å°†æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ç¯å¢ƒæ·»åŠ åˆ°`studio-conda`ä¸­å‘¢ï¼Ÿ

> ç¬¬ä¸€æ­¥ï¼Œå°†æ–°çš„condaç¯å¢ƒåˆ›å»ºåˆ°/share/conda_envsä¸‹
>
> > conda create -p /share/conda_envs/xxx python=3.1x
>
> ç¬¬äºŒæ­¥ï¼Œå°†æœ¬æœº/root/.conda/pkgsä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°/share/pkgsä¸­ï¼Œé‡æ–°å‹ç¼©å¹¶æ›¿æ¢(æ­¤æ­¥éª¤æ˜¯ä¸ºäº†æŠŠcondaåˆ›å»ºè¿‡ç¨‹ä¸­å¤§çš„å…¬å…±åŒ…å­˜å‚¨èµ·æ¥ï¼Œé¿å…é‡å¤ä¸‹è½½)
>
> > cp -r -n /root/.conda/pkgs/* /share/pkgs/
> >
> > cd /share && tar -zcvf pkgs.tar.gz pkgs
>
> ç¬¬ä¸‰æ­¥ï¼Œæ›´æ–°install_conda_env.shä¸­çš„listå‡½æ•°ï¼Œå¢åŠ æ–°çš„condaç¯å¢ƒè¯´æ˜ã€‚
>

ä¸Šé¢æ˜¯å¼€å‘æœºé»˜è®¤æä¾›çš„æ–¹æ³•ï¼Œå…¶å®è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å‰é¢ä½¿ç”¨`conda`å¯¼å‡ºè¿‡`xtuner0.1.17`è™šæ‹Ÿç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`conda env create -f xtuner0.1.17.yml`å‘½ä»¤æ¥è¿˜åŸè™šæ‹Ÿç¯å¢ƒã€‚ä¸‹é¢æˆ‘ä»¬æ¥å†™ä¸€ä¸ªç®€å•çš„Shellè„šæœ¬æ¥å®ç°è¿™ä¸ªæ“ä½œï¼šæˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`test.sh`æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```Bash
#!/bin/bash

# å®šä¹‰å¯¼å‡ºç¯å¢ƒçš„å‡½æ•°
export_env() {
    local env_name=$1
    echo "æ­£åœ¨å¯¼å‡ºç¯å¢ƒ: $env_name"
    # å¯¼å‡ºç¯å¢ƒåˆ°å½“å‰ç›®å½•ä¸‹çš„env_name.ymlæ–‡ä»¶
    conda env export -n "$env_name" > "$env_name.yml"
    echo "ç¯å¢ƒå¯¼å‡ºå®Œæˆã€‚"
}

# å®šä¹‰è¿˜åŸç¯å¢ƒçš„å‡½æ•°
restore_env() {
    local env_name=$1
    echo "æ­£åœ¨è¿˜åŸç¯å¢ƒ: $env_name"
    # ä»å½“å‰ç›®å½•ä¸‹çš„env_name.ymlæ–‡ä»¶è¿˜åŸç¯å¢ƒ
    conda env create -n "$env_name" -f "$env_name.yml"
    echo "ç¯å¢ƒè¿˜åŸå®Œæˆã€‚"
}

# æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å‚æ•°
if [ $# -ne 2 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <æ“ä½œ> <ç¯å¢ƒå>"
    echo "æ“ä½œå¯ä»¥æ˜¯ 'export' æˆ– 'restore'"
    exit 1
fi

# æ ¹æ®å‚æ•°æ‰§è¡Œæ“ä½œ
case "$1" in
    export)
        export_env "$2"
        ;;
    restore)
        restore_env "$2"
        ;;
    *)
        echo "æœªçŸ¥æ“ä½œ: $1"
        exit 1
        ;;
esac
```

å½“æˆ‘ä»¬å®ŒæˆShellè„šæœ¬çš„åˆ›å»ºä»¥åæˆ‘ä»¬éœ€è¦ä¸ºè„šæœ¬èµ‹äºˆæƒé™ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š`chmod +x test.sh` ï¼Œç„¶åè¾“å…¥`./test.sh restore xtuner0.1.17`å¹¶æŒ‰ä¸‹å›è½¦å°±å¯ä»¥è¿˜åŸè™šæ‹Ÿç¯å¢ƒäº†ã€‚(è¿™é‡Œæœ¬åœ°å·²ç»å­˜åœ¨è¯¥ç¯å¢ƒäº†)

![img](./image/15.png)

ä¸è¿‡è¿™ç§è·Ÿç›´æ¥ä½¿ç”¨æ²¡ä»€ä¹ˆå¤ªå¤§åŒºåˆ«ï¼Œå¦‚æœå°†è¿™ç§æ“ä½œä¸å¼€å‘æœºä¸­çš„`studio-conda`å‘½ä»¤ç»“åˆèµ·æ¥ä¼šéå¸¸æ–¹ä¾¿ï¼Œä¸è¿‡ç”±äºå¤åˆ¶ç¯å¢ƒçš„æ–¹æ³•ä¸å¤ªä¸€æ ·ã€‚æ‰€ä»¥å¦‚æœè¦å®ç°éœ€è¦å¯¹`/share/install_conda_env.sh`æ–‡ä»¶çš„é€»è¾‘è¿›è¡Œä¿®æ”¹ã€‚

### æ€»ç»“

â€‹       è¿™èŠ‚è¯¾çŸ¥è¯†ç‚¹é‡ç‚¹åœ¨åŸºç¡€çŸ¥è¯†çš„ç†è§£å’Œè¿ç”¨ï¼Œæ•´ä¸ªæµç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¸Œæœ›åŒå­¦ä»¬å¯ä»¥è‡ªå·±å¤šç†Ÿæ‚‰linuxå‘½ä»¤å’ŒInternStudioå¼€å‘æœºï¼Œæ¯•ç«Ÿç†Ÿç»ƒåº¦ä¸Šæ¥äº†ï¼Œæ–¹ä¾¿åç»­çš„å­¦ä¹ ğŸ˜€ğŸ˜€ğŸ˜€ã€‚